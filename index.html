<!DOCTYPE html><html lang=en><head><meta charset=UTF-8><meta name=viewport content="width=device-width,initial-scale=1.0"><title>Dashboard - Complete</title><link rel=stylesheet href=styles.css></head><body><div class=app-container><div class=sidebar><div class=sidebar-header><div class=dropdown id=sectionDropdownSidebar><button class="dropdown-toggle sidebar-dropdown header-dropdown" id=dropdownToggleSidebar><svg fill=none stroke=currentColor viewBox="0 0 24 24" width=16 height=16><path stroke-linecap=round stroke-linejoin=round stroke-width=2 d="M4 6h16M4 12h16M4 18h16"></path></svg><span id=currentSectionSidebar>Dashboard</span><svg fill=none stroke=currentColor viewBox="0 0 24 24" width=14 height=14><path stroke-linecap=round stroke-linejoin=round stroke-width=2 d="M19 9l-7 7-7-7"></path></svg></button><div class=dropdown-menu></div></div></div><div class=search-container><div class=search-box><input type=text placeholder="Search actions..."><kbd>⌘K</kbd></div></div><nav class=sub-nav-section id=dashboard-nav style=display:none><div class=sub-nav-title>Dashboard</div><a href=# class=nav-item data-section=overview><svg fill=none stroke=currentColor viewBox="0 0 24 24"><path stroke-linecap=round stroke-linejoin=round stroke-width=2 d="M9 17V7m0 10a2 2 0 01-2 2H5a2 2 0 01-2-2V7a2 2 0 012-2h2a2 2 0 012 2m0 10a2 2 0 002 2h2a2 2 0 002-2M9 7a2 2 0 012-2h2a2 2 0 012 2m0 10V7m0 10a2 2 0 002 2h2a2 2 0 002-2V7a2 2 0 00-2-2h-2a2 2 0 00-2 2"></path></svg><span>Overview</span></a><a href=# class=nav-item data-section=performance><svg fill=none stroke=currentColor viewBox="0 0 24 24"><path stroke-linecap=round stroke-linejoin=round stroke-width=2 d="M13 7h8m0 0v8m0-8l-8 8-4-4-6 6"></path></svg><span>Performance</span></a><a href=# class=nav-item data-section=activity-log><svg fill=none stroke=currentColor viewBox="0 0 24 24"><path stroke-linecap=round stroke-linejoin=round stroke-width=2 d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg><span>Activity Log</span></a></nav><div class=sidebar-content><div class=quick-links><div class=quick-links-title>Quick Actions</div></div></div><div class="user-section dropdown" id=userDropdown><button class="dropdown-toggle sidebar-dropdown user-dropdown-toggle" id=userDropdownToggle><div class=user-avatar>US</div><svg width=16 height=16 fill=none stroke=currentColor viewBox="0 0 24 24"><path stroke-linecap=round stroke-linejoin=round stroke-width=2 d="M5 15l7-7 7 7"></path></svg></button><div class="dropdown-menu user-dropdown-menu"><a href=# class=dropdown-item onclick=openUserProfile()><svg width=16 height=16 fill=none stroke=currentColor viewBox="0 0 24 24"><path stroke-linecap=round stroke-linejoin=round stroke-width=2 d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"></path></svg><span>Profile</span></a><div class=dropdown-divider></div><a href=# class="dropdown-item text-danger" onclick=showLogoutConfirm()><svg width=16 height=16 fill=none stroke=currentColor viewBox="0 0 24 24"><path stroke-linecap=round stroke-linejoin=round stroke-width=2 d="M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1"></path></svg><span>Sign Out</span></a></div></div></div><div class=main-content><header class=header><div class=header-left><h1 class=header-title>Management Dashboard</h1></div><div class=header-actions><div class=header-search><svg class=search-icon fill=none stroke=currentColor viewBox="0 0 24 24"><path stroke-linecap=round stroke-linejoin=round stroke-width=2 d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path></svg><input type=text placeholder="Search & Quick Actions..." id=dashboardSearch></div><button class=icon-button title=Filter onclick=toggleFilterPanel()><svg width=14 height=14 fill=none stroke=currentColor viewBox="0 0 24 24"><path stroke-linecap=round stroke-linejoin=round stroke-width=2 d="M3 4a1 1 0 011-1h16a1 1 0 011 1v2.586a1 1 0 01-.293.707l-6.414 6.414a1 1 0 00-.293.707V17l-4 4v-6.586a1 1 0 00-.293-.707L3.293 7.293A1 1 0 013 6.586V4z"></path></svg></button><button class=icon-button title=Refresh onclick=refreshDashboard()><svg width=14 height=14 fill=none stroke=currentColor viewBox="0 0 24 24"><path stroke-linecap=round stroke-linejoin=round stroke-width=2 d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"></path></svg></button><button class=icon-button title="Import Data" onclick=showImportModal()><svg width=14 height=14 fill=none stroke=currentColor viewBox="0 0 24 24"><path stroke-linecap=round stroke-linejoin=round stroke-width=2 d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12"></path></svg></button><button class=icon-button title="Export Data" onclick=showExportModal()><svg width=14 height=14 fill=none stroke=currentColor viewBox="0 0 24 24"><path stroke-linecap=round stroke-linejoin=round stroke-width=2 d="M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path></svg></button><button class=icon-button title=Settings onclick=openSettings()><svg width=14 height=14 fill=none stroke=currentColor viewBox="0 0 24 24"><path stroke-linecap=round stroke-linejoin=round stroke-width=2 d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"></path><path stroke-linecap=round stroke-linejoin=round stroke-width=2 d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path></svg></button><button class=icon-button title=Notifications onclick=openNotificationCenter() style=position:relative><svg width=14 height=14 fill=none stroke=currentColor viewBox="0 0 24 24"><path stroke-linecap=round stroke-linejoin=round stroke-width=2 d="M15 17h5l-1.405-1.405A2.032 2.032 0 0118 14.158V11a6.002 6.002 0 00-4-5.659V5a2 2 0 10-4 0v.341C7.67 6.165 6 8.388 6 11v3.159c0 .538-.214 1.055-.595 1.436L4 17h5m6 0v1a3 3 0 11-6 0v-1m6 0H9"></path></svg><span class=notification-badge id=headerNotificationCount style="top:-4px;right:-4px">3</span></button></div></header><div class=content id=main-content><div class=section-content id=dashboard style=display:block><div class=kpi-grid></div><div class=dashboard-grid><div class="grid-item spreadsheet"><div class=card-header><h3>Item Inventory</h3><div class=card-actions><button class=icon-btn><svg width=16 height=16 fill=none stroke=currentColor viewBox="0 0 24 24"><path stroke-linecap=round stroke-linejoin=round stroke-width=2 d="M3 4a1 1 0 011-1h16a1 1 0 011 1v2.586a1 1 0 01-.293.707l-6.414 6.414a1 1 0 00-.293.707V17l-4 4v-6.586a1 1 0 00-.293-.707L3.293 7.293A1 1 0 013 6.586V4z"></path></svg></button><button class=icon-btn><svg width=16 height=16 fill=none stroke=currentColor viewBox="0 0 24 24"><path stroke-linecap=round stroke-linejoin=round stroke-width=2 d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"></path></svg></button></div></div><div class=spreadsheet-container><table class=data-table><thead><tr><th>ID<th>Type<th>Duration<th>Quantity<th>Health Status<th>Location<th>Value ($)</thead><tbody id=inventory-tbody></tbody></table></div></div><div class="grid-item chart-card"><div class=card-header><h3>Metric Distribution</h3><select class=small-select><option>This Month<option>Last 3 Months<option>This Year</select></div><div class=chart-container><div class=mini-chart><div class=bar-chart><div class=bar style=height:40%><span>20-40</span></div><div class=bar style=height:65%><span>40-60</span></div><div class=bar style=height:85%><span>60-80</span></div><div class=bar style=height:45%><span>80+</span></div></div><div class=chart-legend>Value Range</div></div></div></div><div class="grid-item activity-feed"><div class=card-header><h3>Recent Activities</h3><a href=# class=link-btn>View All</a></div><div class=activity-list id=activity-list></div></div><div class="grid-item financial-grid"><div class=card-header><h3>Financial Overview</h3><div class=period-selector><button class="period-btn active">Day</button><button class=period-btn>Week</button><button class=period-btn>Month</button></div></div><div class=finance-cards><div class="finance-card income"><div class=finance-label>Income</div><div class=finance-value>$3,450</div><div class=finance-trend>↑ 12%</div></div><div class="finance-card expense"><div class=finance-label>Expenses</div><div class=finance-value>$1,280</div><div class=finance-trend>↓ 5%</div></div><div class="finance-card profit"><div class=finance-label>Net Profit</div><div class=finance-value>$2,170</div><div class=finance-trend>↑ 18%</div></div></div></div><div class="grid-item task-board"><div class=card-header><h3>Today's Tasks</h3><button class="button button-small">+ Add Task</button></div><div class=task-columns><div class=task-column><div class="column-header pending">Pending (3)</div><div class=task-card><div class=task-title>Morning routine</div><div class=task-meta>All locations • 7:00 AM</div></div><div class=task-card><div class=task-title>Weight measurement</div><div class=task-meta>Group A • 10:00 AM</div></div></div><div class=task-column><div class="column-header progress">In Progress (1)</div><div class="task-card active"><div class=task-title>Health inspection</div><div class=task-meta>Zone D • Started 9:30 AM</div></div></div><div class=task-column><div class="column-header done">Completed (2)</div><div class="task-card done"><div class=task-title>Water system check</div><div class=task-meta>✓ 6:00 AM</div></div></div></div></div></div></div><div class=section-content id=overview style=display:none><h2>Dashboard Overview</h2><p>Overview content will be displayed here...</div><div class=section-content id=performance style=display:none><h2>Performance Metrics</h2><p>Performance content will be displayed here...</div><div class=section-content id=activity-log style=display:none><h2>Activity Log</h2><p>Activity log content will be displayed here...</div></div></div></div></div></div></div></div><div class=form-overlay onclick=closeAllForms()></div><div class=form-modal id=expense-modal><h3>Add Expense</h3><div class=form-group><label>Description</label><input type=text placeholder="Enter expense description"></div><div class=form-group><label>Amount</label><input type=number placeholder=0.00></div><div class=form-group><label>Category</label><select><option>Feed & Supplies<option>Veterinary<option>Equipment<option>Labor<option>Other</select></div><div class=form-actions><button class="button button-primary" onclick=saveExpense()>Save</button><button class=button onclick="closeModal('expense-modal')">Cancel</button></div></div><div class=form-modal id=revenue-modal><h3>Add Revenue</h3><div class=form-group><label>Source</label><input type=text placeholder=Customer/Source></div><div class=form-group><label>Amount</label><input type=number placeholder=0.00></div><div class=form-group><label>Type</label><select><option>Item Sale<option>Material Sale<option>Enhancement Service<option>Other</select></div><div class=form-actions><button class="button button-primary" onclick=saveRevenue()>Save</button><button class=button onclick="closeModal('revenue-modal')">Cancel</button></div></div><div class=form-modal id=health-record-modal><h3>Add Health Record</h3><div class=form-group><label>Item ID</label><select><option>#001 - Type A<option>#002 - Type B<option>#003 - Type C</select></div><div class=form-group><label>Record Type</label><select><option>Vaccination<option>Health Check<option>Treatment<option>Weight Record</select></div><div class=form-group><label>Date</label><input type=date></div><div class=form-group><label>Veterinarian</label><input type=text placeholder="Dr. Name"></div><div class=form-group><label>Notes</label><textarea placeholder="Enter details..."></textarea></div><div class=form-actions><button class="button button-primary">Save Record</button><button class=button onclick="closeModal('health-record-modal')">Cancel</button></div></div><script src=main.js></script><script>const menuItems=[{id:'dashboard',icon:'M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6',label:'Dashboard'}];const kpis=[{type:'blue',icon:'M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 715.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z',value:'342',label:'Total Sheep',change:'+18 new births this month',changeType:'positive'},{type:'green',icon:'M16 11V7a4 4 0 00-8 0v4M8 11v6a2 2 0 002 2h4a2 2 0 002-2v-6M8 11h8',value:'1,250 kg',label:'Meat Inventory',change:'Ready for processing',changeType:'positive'},{type:'orange',icon:'M3 3h2l.4 2M7 13h10l4-8H5.4m0 0L7 13m0 0l-1.5 6M7 13l-1.5 6m0 0h9M17 21v-2a4 4 0 00-4-4H9a4 4 0 00-4 4v2',value:'47',label:'Online Orders',change:'Today: +23% vs yesterday',changeType:'positive'},{type:'purple',icon:'M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z',value:'96%',label:'Flock Health',change:'Excellent condition',changeType:'positive'}];const activities=[{type:'green',title:'18 new lambs born',meta:'Pasture C • 2 hours ago'},{type:'blue',title:'Vaccination program completed',meta:'342 sheep • Yesterday'},{type:'orange',title:'Feed delivery scheduled',meta:'4.5 tons premium feed • Tomorrow 10 AM'},{type:'green',title:'Online order processed',meta:'Premium meat package • 30 minutes ago'},{type:'red',title:'Health check required',meta:'Sheep #203, #156 • Due in 2 days'}];const inventory=[{id:'SH-001',type:'Adult Ewe',duration:36,quantity:45,status:'Healthy',statusClass:'success',location:'Pasture A',value:380},{id:'SH-002',type:'Adult Ram',duration:48,quantity:12,status:'Healthy',statusClass:'success',location:'Pasture B',value:420},{id:'SH-003',type:'Lamb',duration:8,quantity:28,status:'Growing',statusClass:'info',location:'Nursery',value:180},{id:'SH-004',type:'Pregnant Ewe',duration:42,quantity:15,status:'Monitored',statusClass:'warning',location:'Maternity',value:450},{id:'MT-001',type:'Processed Meat',duration:0,quantity:125,status:'Ready to Ship',statusClass:'success',location:'Cold Storage',value:2800}];document.addEventListener('DOMContentLoaded',()=>{const dm=document.querySelector('.dropdown-menu');dm.innerHTML=menuItems.map((m,i)=>`${i===6?'<div class=dropdown-divider></div>':''}${m.isHeader?`<div class="dropdown-header"><svg fill=none stroke=currentColor viewBox="0 0 24 24"><path stroke-linecap=round stroke-linejoin=round stroke-width=2 d="${m.icon}"></path></svg><span>${m.label}</span></div>`:`<a href=# class="dropdown-item${i===0?' active':''}" data-section=${m.id}><svg fill=none stroke=currentColor viewBox="0 0 24 24"><path stroke-linecap=round stroke-linejoin=round stroke-width=2 d="${m.icon}"></path></svg><span>${m.label}</span></a>`}`).join('');initializeDropdown();const kg=document.querySelector('.kpi-grid');kg.innerHTML=kpis.map(k=>`<div class="kpi-card ${k.type}"><div class=kpi-icon><svg fill=none stroke=currentColor viewBox="0 0 24 24"><path stroke-linecap=round stroke-linejoin=round stroke-width=2 d="${k.icon}"></path></svg></div><div class=kpi-content><div class=kpi-value>${k.value}</div><div class=kpi-label>${k.label}</div><div class="kpi-change ${k.changeType}">${k.change}</div></div></div>`).join('');const al=document.getElementById('activity-list');al.innerHTML=activities.map(a=>`<div class=activity-item><div class="activity-indicator ${a.type}"></div><div class=activity-content><div class=activity-title>${a.title}</div><div class=activity-meta>${a.meta}</div></div></div>`).join('');const it=document.getElementById('inventory-tbody');it.innerHTML=inventory.map(i=>`<tr><td>${i.id}</td><td>${i.type}</td><td>${i.duration}</td><td>${i.quantity}</td><td><span class="badge badge-${i.statusClass}">${i.status}</span></td><td>${i.location}</td><td>${i.value}</td></tr>`).join('')});

    const expenses = parseFloat(document.getElementById('monthly-expenses').value) || 0;
    
    const resultDiv = document.getElementById('profit-result');
    
    if (revenue === 0 && expenses === 0) {
        resultDiv.innerHTML = '<strong>Enter your numbers above to see results</strong>';
        resultDiv.style.background = 'var(--bg-secondary)';
        return;
    }
    
    const profit = revenue - expenses;
    const margin = revenue > 0 ? ((profit / revenue) * 100).toFixed(1) : 0;
    
    if (profit > 0) {
        resultDiv.innerHTML = `<strong style="color: var(--success);">✅ PROFITABLE</strong><br>
            Net Profit: $${profit.toLocaleString()}<br>
            Profit Margin: ${margin}%<br>
            <small>This business shows positive profitability</small>`;
        resultDiv.style.background = 'var(--success-light)';
    } else if (profit < 0) {
        resultDiv.innerHTML = `<strong style="color: var(--danger);">❌ LOSS</strong><br>
            Net Loss: $${Math.abs(profit).toLocaleString()}<br>
            Loss Margin: ${Math.abs(margin)}%<br>
            <small>Revenue needs to increase or costs need to decrease</small>`;
        resultDiv.style.background = 'var(--error-light)';
    } else {
        resultDiv.innerHTML = `<strong style="color: var(--warning);">⚖️ BREAK-EVEN</strong><br>
            Net Profit: $0<br>
            Profit Margin: 0%<br>
            <small>Revenue equals expenses</small>`;
        resultDiv.style.background = 'var(--warning-light)';
    }
}


// Auto-update revenue total
function autoUpdateRevenue() {
    const sheepRevenue = parseFloat(document.getElementById('sheep-revenue').value) || 0;
    const meatRevenue = parseFloat(document.getElementById('meat-revenue').value) || 0;
    const onlineRevenue = parseFloat(document.getElementById('online-revenue').value) || 0;
    const seasonalRevenue = parseFloat(document.getElementById('seasonal-revenue').value) || 0;
    
    const totalRevenue = sheepRevenue + meatRevenue + onlineRevenue + seasonalRevenue;
    document.getElementById('revenue-total').textContent = totalRevenue.toLocaleString();
}

function calculateBreakEven() {
    const fixedCosts = parseFloat(document.getElementById('fixed-costs').value) || 0;
    const variableCost = parseFloat(document.getElementById('variable-cost').value) || 0;
    const sellingPrice = parseFloat(document.getElementById('selling-price').value) || 0;
    
    const resultDiv = document.getElementById('breakeven-result');
    resultDiv.style.display = 'block';
    
    if (sellingPrice <= variableCost) {
        resultDiv.innerHTML = `<strong style="color: var(--danger);">❌ IMPOSSIBLE</strong><br>
            Selling price must be higher than variable cost<br>
            <small>Adjust pricing or reduce variable costs</small>`;
        return;
    }
    
    const contributionMargin = sellingPrice - variableCost;
    const breakEvenUnits = Math.ceil(fixedCosts / contributionMargin);
    const breakEvenRevenue = breakEvenUnits * sellingPrice;
    
    resultDiv.innerHTML = `<strong style="color: var(--primary);">⚖️ BREAK-EVEN POINT</strong><br>
        Units needed: ${breakEvenUnits.toLocaleString()}<br>
        Revenue needed: $${breakEvenRevenue.toLocaleString()}<br>
        Contribution margin: $${contributionMargin.toFixed(2)} per unit`;
    resultDiv.style.background = 'var(--info-light)';
}

function calculateFinancialModel() {
    // Calculate total expenses
    const feedCosts = parseFloat(document.getElementById('feed-costs').value) || 0;
    const vetCosts = parseFloat(document.getElementById('vet-costs').value) || 0;
    const laborCosts = parseFloat(document.getElementById('labor-costs').value) || 0;
    const infrastructureCosts = parseFloat(document.getElementById('infrastructure-costs').value) || 0;
    const marketingCosts = parseFloat(document.getElementById('marketing-costs').value) || 0;
    const shippingCosts = parseFloat(document.getElementById('shipping-costs').value) || 0;
    const processingCosts = parseFloat(document.getElementById('processing-costs').value) || 0;
    const otherCosts = parseFloat(document.getElementById('other-costs').value) || 0;
    
    const totalExpenses = feedCosts + vetCosts + laborCosts + infrastructureCosts + 
                         marketingCosts + shippingCosts + processingCosts + otherCosts;
    
    // Calculate total revenue
    const sheepRevenue = parseFloat(document.getElementById('sheep-revenue').value) || 0;
    const meatRevenue = parseFloat(document.getElementById('meat-revenue').value) || 0;
    const onlineRevenue = parseFloat(document.getElementById('online-revenue').value) || 0;
    const seasonalRevenue = parseFloat(document.getElementById('seasonal-revenue').value) || 0;
    
    const totalRevenue = sheepRevenue + meatRevenue + onlineRevenue + seasonalRevenue;
    const netProfit = totalRevenue - totalExpenses;
    
    // Update revenue total display
    document.getElementById('revenue-total').textContent = totalRevenue.toLocaleString();
    
    // Show results
    const resultsDiv = document.getElementById('financial-model-results');
    resultsDiv.style.display = 'block';
    
    document.getElementById('model-revenue').textContent = `$${totalRevenue.toLocaleString()}`;
    document.getElementById('model-expenses').textContent = `$${totalExpenses.toLocaleString()}`;
    
    const profitElement = document.getElementById('model-profit');
    profitElement.textContent = `$${netProfit.toLocaleString()}`;
    
    if (netProfit > 0) {
        profitElement.style.color = 'var(--success)';
    } else {
        profitElement.style.color = 'var(--danger)';
    }
}

function calculateAdvancedBreakEven() {
    const fixedCosts = parseFloat(document.getElementById('advanced-fixed-costs').value) || 0;
    const variableCostSheep = parseFloat(document.getElementById('variable-cost-sheep').value) || 0;
    const variableCostMeat = parseFloat(document.getElementById('variable-cost-meat').value) || 0;
    const sheepPrice = parseFloat(document.getElementById('sheep-price').value) || 0;
    const meatPrice = parseFloat(document.getElementById('meat-price').value) || 0;
    const sheepWeight = parseFloat(document.getElementById('sheep-weight').value) || 0;
    
    // Calculate break-even for sheep sales
    const sheepContributionMargin = sheepPrice - variableCostSheep;
    const breakEvenSheep = sheepContributionMargin > 0 ? Math.ceil(fixedCosts / sheepContributionMargin) : 0;
    
    // Calculate break-even for meat sales
    const meatContributionMargin = meatPrice - variableCostMeat;
    const breakEvenMeat = meatContributionMargin > 0 ? Math.ceil(fixedCosts / meatContributionMargin) : 0;
    
    // Show results
    const resultsDiv = document.getElementById('advanced-breakeven-results');
    resultsDiv.style.display = 'block';
    
    document.getElementById('breakeven-sheep').textContent = breakEvenSheep.toLocaleString();
    document.getElementById('breakeven-meat').textContent = breakEvenMeat.toLocaleString();
}

function runScenarioAnalysis() {
    // This function could be expanded to dynamically calculate scenarios
    // For now, it just highlights that the analysis has been run
    const scenarios = document.getElementById('scenario-results');
    scenarios.style.background = 'var(--info-light)';
    setTimeout(() => {
        scenarios.style.background = '';
    }, 2000);
}

function generateRecommendation() {
    const recommendationDiv = document.getElementById('final-recommendation');
    recommendationDiv.style.display = 'block';
}








// Cash Flow Analysis Functions


// Sensitivity Analysis Functions
function updateSensitivityAnalysis() {
    const revenueChange = parseFloat(document.getElementById('revenue-sensitivity').value) || 0;
    const costChange = parseFloat(document.getElementById('cost-sensitivity').value) || 0;
    const marketChange = parseFloat(document.getElementById('market-sensitivity').value) || 0;
    const competitionChange = parseFloat(document.getElementById('competition-sensitivity').value) || 0;
    
    // Update display values
    document.getElementById('revenue-sensitivity-value').textContent = revenueChange + '%';
    document.getElementById('cost-sensitivity-value').textContent = costChange + '%';
    document.getElementById('market-sensitivity-value').textContent = marketChange + '%';
    document.getElementById('competition-sensitivity-value').textContent = competitionChange + '%';
    
    // Calculate adjusted metrics
    const baseNPV = 245000;
    const baseROI = 25;
    
    const npvAdjustment = (revenueChange * 5000) - (costChange * 3000) + 
                         (marketChange * 2000) - (competitionChange * 1500);
    const adjustedNPV = baseNPV + npvAdjustment;
    
    const roiAdjustment = (revenueChange * 0.3) - (costChange * 0.2) + 
                         (marketChange * 0.1) - (competitionChange * 0.15);
    const adjustedROI = baseROI + roiAdjustment;
    
    // Update results
    document.getElementById('adjusted-npv').textContent = `$${adjustedNPV.toLocaleString()}`;
    document.getElementById('roi-change').textContent = 
        `${adjustedROI >= baseROI ? '+' : ''}${(adjustedROI - baseROI).toFixed(1)}%`;
    
    // Risk assessment
    const totalRisk = Math.abs(revenueChange) + Math.abs(costChange) + 
                     Math.abs(marketChange) + Math.abs(competitionChange);
    let riskLevel = 'Low';
    if (totalRisk > 100) riskLevel = 'High';
    else if (totalRisk > 50) riskLevel = 'Medium';
    
    document.getElementById('risk-change').textContent = riskLevel;
    
    // Break-even adjustment
    const breakEvenMonths = 12 + Math.round((costChange - revenueChange) / 10);
    document.getElementById('breakeven-change').textContent = Math.max(1, breakEvenMonths) + ' months';
}





// Make functions globally available
window.autoUpdateRevenue = autoUpdateRevenue;
window.calculateProfitability = calculateProfitability;
window.calculateBreakEven = calculateBreakEven;
window.calculateFinancialModel = calculateFinancialModel;
window.calculateAdvancedBreakEven = calculateAdvancedBreakEven;
window.runScenarioAnalysis = runScenarioAnalysis;
window.generateRecommendation = generateRecommendation;
window.updateSensitivityAnalysis = updateSensitivityAnalysis;

function updateMarketAnalysis() {
    const tam = parseFloat(document.getElementById('tam-size-mr')?.value || 0);
    const marketShare = parseFloat(document.getElementById('market-share-mr')?.value || 0);
    const growthRate = parseFloat(document.getElementById('market-growth-mr')?.value || 0);
    const customerLtv = parseFloat(document.getElementById('customer-ltv-mr')?.value || 0);
    const acquisitionCost = parseFloat(document.getElementById('customer-acquisition-cost')?.value || 0);
    const timeline = parseFloat(document.getElementById('market-penetration-timeline')?.value || 0);
    
    if (tam > 0 && marketShare > 0) {
        const targetRevenue = tam * (marketShare / 100);
        const projectedCustomers = customerLtv > 0 ? Math.floor(targetRevenue / customerLtv) : 0;
        const totalAcquisitionCost = projectedCustomers * acquisitionCost;
        const netOpportunity = targetRevenue - totalAcquisitionCost;
        const monthlyGrowthRate = growthRate / 12;
        
        const resultText = `Target Market Value: ${formatCurrency(targetRevenue)}<br>
                           Projected Customers: ${projectedCustomers.toLocaleString()}<br>
                           Customer Acquisition Cost: ${formatCurrency(totalAcquisitionCost)}<br>
                           Net Market Opportunity: ${formatCurrency(netOpportunity)}<br>
                           Timeline to Penetration: ${timeline} months<br>
                           Monthly Growth Required: ${monthlyGrowthRate.toFixed(2)}%`;
        
        const resultEl = document.getElementById('market-opportunity-text');
        if (resultEl) resultEl.innerHTML = resultText;
    }
}

window.updateMarketAnalysis = updateMarketAnalysis;





function calculateIRR(investment, revenue, expenses, growthRate, years) {
    let rate = 0.1;
    for (let i = 0; i < 100; i++) {
        let npv = -investment;
        let rev = revenue;
        let exp = expenses;
        for (let year = 1; year <= years; year++) {
            npv += (rev - exp) / Math.pow(1 + rate, year);
            rev *= (1 + growthRate);
            exp *= 1.03;
        }
        if (Math.abs(npv) < 0.01) break;
        rate += npv > 0 ? 0.01 : -0.01;
    }
    return rate * 100;
}



function updateStrategicAnalysis() {
    const targetCustomers = parseFloat(document.getElementById('target-customers-rs')?.value || 0);
    const revenueGrowth = parseFloat(document.getElementById('target-revenue-growth')?.value || 0);
    const marketShareTarget = parseFloat(document.getElementById('market-share-target')?.value || 0);
    const customerRetention = parseFloat(document.getElementById('customer-retention')?.value || 0);
    const breakEvenTimeline = parseFloat(document.getElementById('breakeven-timeline')?.value || 0);
    const minROITarget = parseFloat(document.getElementById('min-roi-target')?.value || 0);
    
    if (targetCustomers > 0 && revenueGrowth > 0) {
        const avgCustomerValue = 2400; // Assume average from market research
        const projectedRevenue = targetCustomers * avgCustomerValue;
        const monthlyCustomerTarget = Math.ceil(targetCustomers / 12);
        const retentionValue = (customerRetention / 100) * avgCustomerValue;
        const churnRate = 100 - customerRetention;
        
        const strategicText = `Year 1 Revenue Target: ${formatCurrency(projectedRevenue)}<br>
                             Monthly Customer Acquisition: ${monthlyCustomerTarget.toLocaleString()}<br>
                             Customer Lifetime Value: ${formatCurrency(retentionValue)}<br>
                             Churn Rate: ${churnRate.toFixed(1)}%<br>
                             Break-Even Target: Month ${breakEvenTimeline}<br>
                             Minimum ROI Threshold: ${minROITarget}%<br>
                             Strategic Feasibility: ${marketShareTarget <= 10 && breakEvenTimeline <= 18 ? 'High' : 'Medium'}`;
        
        document.getElementById('strategic-text').innerHTML = strategicText;
    }
}

function runScenarioAnalysisRS() {
    const baseRevenue = 180000; // Base case revenue
    const baseCosts = 150000;   // Base case costs
    
    const optimisticRevMult = parseFloat(document.getElementById('optimistic-revenue')?.value || 1.5);
    const optimisticCostEff = parseFloat(document.getElementById('optimistic-cost-efficiency')?.value || 20) / 100;
    const optimisticMarketBoost = parseFloat(document.getElementById('optimistic-market-boost')?.value || 10) / 100;
    
    const realisticRevMult = parseFloat(document.getElementById('realistic-revenue')?.value || 1.0);
    const realisticCostEff = parseFloat(document.getElementById('realistic-cost-efficiency')?.value || 5) / 100;
    const realisticMarketBoost = parseFloat(document.getElementById('realistic-market-boost')?.value || 0) / 100;
    
    const pessimisticRevMult = parseFloat(document.getElementById('pessimistic-revenue')?.value || 0.7);
    const pessimisticCostEff = parseFloat(document.getElementById('pessimistic-cost-efficiency')?.value || -10) / 100;
    const pessimisticMarketBoost = parseFloat(document.getElementById('pessimistic-market-boost')?.value || -15) / 100;
    
    const scenarios = [
        {
            name: 'Optimistic',
            revenue: baseRevenue * optimisticRevMult * (1 + optimisticMarketBoost),
            costs: baseCosts * (1 - optimisticCostEff),
            probability: '25%'
        },
        {
            name: 'Realistic',
            revenue: baseRevenue * realisticRevMult * (1 + realisticMarketBoost),
            costs: baseCosts * (1 - realisticCostEff),
            probability: '50%'
        },
        {
            name: 'Pessimistic',
            revenue: baseRevenue * pessimisticRevMult * (1 + pessimisticMarketBoost),
            costs: baseCosts * (1 - pessimisticCostEff),
            probability: '25%'
        }
    ];
    
    const scenarioText = scenarios.map(s => {
        const profit = s.revenue - s.costs;
        const margin = (profit / s.revenue) * 100;
        return `<strong>${s.name} (${s.probability}):</strong> Revenue ${formatCurrency(s.revenue)} | Costs ${formatCurrency(s.costs)} | Profit ${formatCurrency(profit)} (${margin.toFixed(1)}%)`;
    }).join('<br>');
    
    const expectedValue = scenarios.reduce((sum, s, i) => {
        const prob = i === 1 ? 0.5 : 0.25; // 50% realistic, 25% each other
        return sum + (s.revenue - s.costs) * prob;
    }, 0);
    
    const finalText = scenarioText + `<br><br><strong>Expected Value: ${formatCurrency(expectedValue)}</strong>`;
    document.getElementById('scenario-text').innerHTML = finalText;
}

function calculateExitValue() {
    const saleMultiple = parseFloat(document.getElementById('sale-multiple')?.value || 0);
    const exitTimeline = parseFloat(document.getElementById('exit-timeline')?.value || 0);
    const strategicPremium = parseFloat(document.getElementById('strategic-premium')?.value || 0) / 100;
    const baseRevenue = 180000; // Year 1 revenue
    const growthRate = 0.15; // 15% annual growth
    
    if (saleMultiple > 0 && exitTimeline > 0) {
        const exitYearRevenue = baseRevenue * Math.pow(1 + growthRate, exitTimeline);
        const baseValuation = exitYearRevenue * saleMultiple;
        const strategicValuation = baseValuation * (1 + strategicPremium);
        const totalReturn = strategicValuation;
        const annualizedReturn = Math.pow(totalReturn / 450000, 1 / exitTimeline) - 1; // Assuming 450k investment
        
        const exitText = `Business Valuation (Year ${exitTimeline}): ${formatCurrency(baseValuation)}<br>
                          Strategic Buyer Valuation: ${formatCurrency(strategicValuation)}<br>
                          Projected Annual Revenue: ${formatCurrency(exitYearRevenue)}<br>
                          Total Return Multiple: ${(totalReturn / 450000).toFixed(1)}x<br>
                          Annualized Return: ${(annualizedReturn * 100).toFixed(1)}%`;
        
        document.getElementById('exit-text').innerHTML = exitText;
    }
}

window.updateStrategicAnalysis = updateStrategicAnalysis;
window.runScenarioAnalysisRS = runScenarioAnalysisRS;
window.calculateExitValue = calculateExitValue;</script></body></html>